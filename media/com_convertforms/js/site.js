!function(e,t){"use strict";var r=function(r){var o={selector:r},n=e.ConvertForms.Helper,a=r.querySelector("form"),i={INVALID_RESPONSE:"Invalid Response",INVALID_TASK:"Invalid Task",ERROR_WAIT_FILE_UPLOADS:"Please wait file uploading to complete.",ERROR_INPUTMASK_INCOMPLETE:"Mask is incomplete",SUBMISSION_CANCELLED:"Submission Cancelled"};o.submit=function(){var t=o.emitEvent("beforeSubmit");if(t.defaultPrevented){var i=t.detail.hasOwnProperty("error")?t.detail.error:o.text("SUBMISSION_CANCELLED");o.throwError(i)}else n.request({url:n.getBaseURL()+"index.php?option=com_convertforms&task=submit",headers:{"X-CSRF-Token":n.getCSRFToken()},data:n.getFormData(a),onBefore:function(){r.classList.add("cf-working"),r.classList.add("cf-disabled"),r.classList.remove("cf-error"),r.classList.remove("cf-success")},onSuccess:function(t,a){try{t=JSON.parse(t)}catch(e){var i=t.match('{"convertforms"(.*?)}$');if(null==i)return void o.throwError(o.text("INVALID_RESPONSE")+": "+t);t=JSON.parse(i[0])}if(t.success){o.emitEvent("success",{response:t,xhr:a});var s="formTask"+n.capitalize(t.task);if(!o.hasOwnProperty(s))return void o.throwError(o.text("INVALID_TASK")+": "+s);o[s].call(e,t),o.emitEvent("afterTask",{response:t,xhr:a,task:t.task})}else o.emitEvent("error",{response:t,xhr:a}),o.throwError(t.error),r.querySelector(".cf-fields > .cf-control-group:first-child .cf-input").focus()},onComplete:function(e){o.emitEvent("afterSubmit",{xhr:e}),r.classList.remove("cf-working"),r.classList.remove("cf-disabled");var t=r.querySelector(".cf-response");n.isInViewport(t)||t.scrollIntoView()},onError:function(e,t){o.throwError("Error: "+e)},onFail:function(e,t){o.throwError("Fail: "+e)}})},o.emitEvent=function(e,a,i){if(e){if((a=a||{}).instance=o,i=i||!0){var s="ConvertForms"+n.capitalize(e);n.emitEvent(s,t,a)}return n.emitEvent(e,r,a)}},o.formTaskMsg=function(e){r.classList.add("cf-success"),r.querySelector(".cf-response").innerHTML=e.value,"1"==e.resetform&&a.reset()},o.formTaskUrl=function(t){var r=t.value;if("1"==t.passdata){var o=n.getFormData(a),i=n.serializeFormData(o,!0);r+=(t.value.indexOf("?")>-1?"&":"?")+i}e.location.href=r},o.throwError=function(e){r.classList.add("cf-error"),r.querySelector(".cf-response").innerHTML=e},o.text=function(e){return i[e]};return r.classList.contains("cf-init")||(e.IntersectionObserver&&new IntersectionObserver(function(e,t){e.forEach(function(e){e.isIntersecting&&(o.emitEvent("impression",{entry:e}),t.unobserve(e.target))})},{rootMargin:"0px 0px 0px 0px"}).observe(r),a.addEventListener("submit",function(e){e.preventDefault(),o.submit(e)}),r.classList.add("cf-init")),o};e.ConvertForms=e.ConvertForms||[],t.addEventListener("DOMContentLoaded",function(){for(var o=t.querySelectorAll(".convertforms"),n=0;n<o.length;n++){var a=o[n];r(a)}e.ConvertForms.Helper.emitEvent("ConvertFormsInit",t,o)})}(window,document),document.addEventListener("ConvertFormsInit",function(e){if("undefined"!=typeof Dropzone){var t=e.detail,r=ConvertForms.Helper.getBaseURL()+"index.php?option=com_ajax&format=raw&plugin=convertforms&task=field&field_type=fileupload",o=ConvertForms.Helper.getCSRFToken();Dropzone.autoDiscover=!1,Dropzone.prototype.defaultOptions.dictFallbackMessage=Joomla.JText._("COM_CONVERTFORMS_UPLOAD_FALLBACK_MESSAGE"),Dropzone.prototype.defaultOptions.dictFileTooBig=Joomla.JText._("COM_CONVERTFORMS_UPLOAD_FILETOOBIG"),Dropzone.prototype.defaultOptions.dictInvalidFileType=Joomla.JText._("COM_CONVERTFORMS_UPLOAD_INVALID_FILE"),Dropzone.prototype.defaultOptions.dictResponseError=Joomla.JText._("COM_CONVERTFORMS_UPLOAD_RESPONSE_ERROR"),Dropzone.prototype.defaultOptions.dictCancelUpload=Joomla.JText._("COM_CONVERTFORMS_UPLOAD_CANCEL_UPLOAD"),Dropzone.prototype.defaultOptions.dictCancelUploadConfirmation=Joomla.JText._("COM_CONVERTFORMS_UPLOAD_CANCEL_UPLOAD_CONFIRMATION"),Dropzone.prototype.defaultOptions.dictRemoveFile=Joomla.JText._("COM_CONVERTFORMS_UPLOAD_REMOVE_FILE"),Dropzone.prototype.defaultOptions.dictMaxFilesExceeded=Joomla.JText._("COM_CONVERTFORMS_UPLOAD_MAX_FILES_EXCEEDED"),t.forEach(function(e){var t=[];e.querySelectorAll(".cfupload").forEach(function(n){var a=n.closest(".cf-control-input").querySelector(".cfup-tmpl"),i=a.innerHTML;a.closest(".cf-control-input").removeChild(a);var s=parseFloat(n.getAttribute("data-maxfilesize"));s=s||null;var l=parseInt(n.getAttribute("data-maxfiles"));l=l||null;var c=e.querySelector("button.cf-btn"),u=new Dropzone(n,{url:r,previewTemplate:i,maxFilesize:s,uploadMultiple:1!=l,maxFiles:l,acceptedFiles:n.getAttribute("data-acceptedfiles"),autoProcessQueue:!0,parallelUploads:1,filesizeBase:1024,createImageThumbnails:!1,timeout:3e5});c&&(u.on("queuecomplete",function(){c.classList.remove("cf-disabled")}),u.on("processing",function(){c.classList.add("cf-disabled")})),u.on("sending",function(e,t,r){r.append("form_id",n.closest("form").querySelector("input[name='cf[form_id]']").value),r.append("field_key",n.getAttribute("data-key")),t.setRequestHeader("X-CSRF-Token",o),r.append(o,1)}),u.on("success",function(e){var t=e.xhr.response;try{t=JSON.parse(t)}catch(e){matches=t.match(/{([^}]*)}/i),null!==matches?t=JSON.parse(matches[0]):alert("Error! "+e+"<br>"+t)}var r=document.createElement("input");r.setAttribute("type","hidden"),r.setAttribute("name",n.dataset.name),r.setAttribute("value",t.file),e.previewTemplate.appendChild(r)}),t.push(u)}),e.addEventListener("beforeSubmit",function(e){var r;e.defaultPrevented||(r=0,t.forEach(function(e){var t=e.getQueuedFiles().length,o=e.getUploadingFiles().length;r=r+t+o}),r>0&&(e.preventDefault(),e.detail.error=e.detail.instance.text("ERROR_WAIT_FILE_UPLOADS")))}),e.addEventListener("success",function(){t.forEach(function(e){e.removeAllFiles()})})})}}),function(e,t){"use strict";var r={getCSRFToken:function(){var e=Joomla.getOptions("csrf.token");return"object"==typeof Joomla&&e?e:ConvertFormsConfig.token},getBaseURL:function(){var e=Joomla.getOptions("system.paths");return"object"==typeof Joomla&&e&&e.root?e.root+"/":ConvertFormsConfig.baseurl},getFormData:function(e){return new FormData(e)},serializeFormData:function(e,t){t=t||!1;var r=[],o=e.entries(),n=Array.isArray(o),a=0;for(o=n?o:o[Symbol.iterator]();;){var i;if(n){if(a>=o.length)break;i=o[a++]}else{if((a=o.next()).done)break;i=a.value}var s=i,l=s[0],c=s[1];if(t&&l.indexOf("cf[")>-1){var u=l.indexOf("[]")>-1;l=l.match(/cf\[(.*?)\]/)[1],u&&(l+="[]")}r.push(encodeURIComponent(l)+"="+encodeURIComponent(c))}return r.join("&")},isInViewport:function(r){var o=r.getBoundingClientRect();return o.top>=0&&o.left>=0&&o.bottom<=(e.innerHeight||t.documentElement.clientHeight)&&o.right<=(e.innerWidth||t.documentElement.clientWidth)},emitEvent:function(e,t,r){var o=new CustomEvent(e,{detail:r,cancelable:!0});return t.dispatchEvent(o),o},request:function(t){t=r.extend({url:"",method:"POST",headers:null,data:null,onSuccess:null,onError:null,onFail:null},t);try{var o=new XMLHttpRequest;if(o.open(t.method,t.url,!0),o.setRequestHeader("X-Requested-With","XMLHttpRequest"),o.setRequestHeader("X-Ajax-Engine","Convert Forms!"),t.headers)for(var n in t.headers)t.headers.hasOwnProperty(n)&&o.setRequestHeader(n,t.headers[n]);if(o.onload=function(){4===o.readyState&&(200===o.status?t.onSuccess&&t.onSuccess.call(e,o.responseText,o):t.onError&&t.onError.call(e,o.responseText,o),t.onComplete&&t.onComplete.call(e,o))},t.onBefore&&!1===t.onBefore.call(e,o))return o;o.send(t.data)}catch(r){return t.onFail&&t.onFail.call(e,r,o),console.error(r),!1}return o},extend:function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);return e},capitalize:function(e){return"string"!=typeof e?"":e.charAt(0).toUpperCase()+e.slice(1)},browserIsIE:function(){var t=e.navigator.userAgent,r=t.indexOf("MSIE "),o=t.indexOf("Trident/");return r>0||o>0},browserIsEdge:function(){return/Edge/.test(e.navigator.userAgent)}};e.ConvertForms=e.ConvertForms||[],e.ConvertForms.Helper=r}(window,document),document.addEventListener("ConvertFormsInit",function(e){"undefined"!=typeof Inputmask&&e.detail.forEach(function(e){var t=e.querySelectorAll(".cf-input[data-inputmask-mask]");t&&(Inputmask("",{jitMasking:!1,showMaskOnHover:!1}).mask(t),e.addEventListener("beforeSubmit",function(e){if(!e.defaultPrevented)for(var r=0;r<t.length;r++){var o=t[r];if(!o.hasAttribute("required"))return;if(!o.inputmask.isComplete()){e.preventDefault(),e.detail.error=e.detail.instance.text("ERROR_INPUTMASK_INCOMPLETE"),o.focus();break}}}))})});
