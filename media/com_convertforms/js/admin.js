jQuery(function(e){e.fn.awesomeEditor=function(t){var i=this,n=e.extend({plugin:"Convert Forms Editor",debug:!0,form:i.find(".nrEditorOptions #adminForm"),root:i.data("root"),GoogleFonts:ConvertFormsGoogleFonts},t),o=new function(){var t=this;this.container=i.get(0),this.init=function(){s(n.root+"media/com_convertforms/css/convertforms.css"),this.resizeContainer(),jQuery("#toolbar").clone().appendTo(e(".nrEditorTools .r")),e(window).resize(function(){t.resizeContainer()})},this.resizeContainer=function(){heights=["header"];var t=0;heights.each(function(i){t+=e(i).outerHeight()}),height=e(window).height()-t,i.height(height+1)},this.initEditorFields=function(){tinyMCE.remove(),tinyMCE.init({init_instance_callback:function(e){e.on("ExecCommand",function(){tinyMCE.triggerSave(),a()}),e.on("blur",function(){tinyMCE.triggerSave(),a()})},content_css:n.root+"templates/system/css/editor.css",document_base_url:n.root,height:"170",plugins:"textcolor, code, colorpicker, fullscreen, link, image",selector:".editorx",toolbar1:"fontsizeselect styleselect link unlink image mybutton",toolbar2:"forecolor | bold italic underline | alignleft aligncenter alignright | code fullscreen",fontsize_formats:"10px 11px 12px 14px 16px 18px 20px 22px 24px 26px 28px 30px 32px 34px 36px 38px 40px 42px 46px 48px 50px 52px",mode:"specific_textareas",entity_encoding:"raw",forced_root_block:"",toolbar_items_size:"small",statusbar:!1,menubar:!1,inline_styles:!0,force_br_newlines:!1,relative_urls:!1,remove_script_host:!1,paste_data_images:!0,importcss_append:!0,image_advtab:!0,valid_children:"+div[style]"})},this.loadGoogleFont=function(e){n.GoogleFonts.indexOf(e)>-1&&s("//fonts.googleapis.com/css?family="+encodeURIComponent(e))},this.goToPanel=function(e,t){i.find(".nav-tabs li a[href=#"+e+"]").trigger("click"),i.find(".tab-content .accordion-group."+t+" .accordion-heading a.collapsed").trigger("click")},this.getFieldList=function(){var e=[];return this.container.querySelectorAll(".fmItem").forEach(function(t){var i=t.querySelector('input[name*="[name]"]');if(i){var n=i.value,o=n,r=t.querySelector('input[name*="[label]"]');r&&""!=r.value.length&&(o=r.value),e[n]=o}}),e}};o.init();var r=!1;function a(t){r||(formData=n.form.find("select, input[name*=jform], textarea").serialize(),e.ajax({type:"POST",url:n.root+"administrator/index.php?option=com_convertforms&view=form&layout=preview&format=raw",data:formData,success:function(i){d("AJAX Request: Success"),t?e(".nrEditorPreviewContainer").hide().html(i).fadeIn():e(".nrEditorPreviewContainer").html(i),e("#preview-loader, #preview-successmsg").trigger("change")},beforeSend:function(){d("AJAX Request: Start"),r=!0,e(".loader").fadeIn()},complete:function(){r=!1,e(".loader").fadeOut()},error:function(e,t,i){l(i)}}))}function s(t){e("link[href='"+t+"']").length?d("Stylesheet "+t+" is already loaded"):(d("Loading stylesheet "+t),e("head").append(e('<link rel="stylesheet" type="text/css" />').attr("href",t)))}function d(e){n.debug&&console.log("["+n.plugin+"] "+e)}function l(e){Joomla.renderMessages({error:[e]})}return i.on("renderForm",function(){a()}),i.on("error",function(e,t){l(t)}),e(document).on("click",".cf-control-group",function(){key=e(this).data("key"),i.trigger("controlGroupClick",[key])}),e(".page-title").click(function(){o.goToPanel("design","box"),e("#jform_name").focus()}),e(document).on("change",".nrEditorOptions input, .nrEditorOptions select, .nrEditorOptions textarea",function(t){var i;($el=e(t.target),$el.hasClass("norender"))||(isColorPicker=$el.hasClass("minicolors-input"),isColorPicker?(i=0,function(e,t){clearTimeout(i),i=setTimeout(e,t)})(function(){a()},100):a())}),e(document).on("subform-row-add subform-row-remove nrChoicesUpdate",function(){setTimeout(function(){a()},50)}),e(document).on("subform-row-add",function(){o.initEditorFields()}),e(document).on("submit",".cf form",function(){return!1}),e(window).load(function(){o.initEditorFields(),e("select.nrfont").change(function(){o.loadGoogleFont(e(this).val())}).trigger("change"),a(!0)}),e(".nrEditorTools #toolbar-refresh .btn").removeAttr("onclick"),e(".nrEditorTools #toolbar-refresh").on("click",function(e){return e.preventDefault(),a(),!1}),e("#preview-loader").change(function(){e(this).is(":checked")?(e("#preview-successmsg").removeAttr("checked").trigger("change"),e(".nrEditorPreview .cf").addClass("cf-working")):e(".nrEditorPreview .cf").removeClass("cf-working")}),e("#preview-successmsg").change(function(){box=e(".nrEditorPreview .cf"),e(this).is(":checked")?(successMessage=e("#jform_successmsg").val(),box.find(".cf-response").html(successMessage),box.addClass("cf-success"),e("#jform_hideform0").is(":checked")?box.addClass("cf-success-hideform"):box.removeClass("cf-success-hideform")):box.removeClass("cf-success cf-error")}),window.ConvertFormsBuilder=o,this}}),jQuery(function(e){editor=e(".nrEditor"),editor.length&&editor.awesomeEditor()}),jQuery(function(e){e(document).on("click",".cf-layout-btn",function(){var t=e(this);container=t.closest(".control-group").find(".cf-layout-classes"),isVisible=container.is(":visible"),container.slideToggle(),t.text(isVisible?t.data("show-label"):t.data("hide-label"))}),e(document).on("click",".cf-layout-classes .cf-layout > span",function(){var t=e(this).closest(".control-group").find("input");value=e.trim(t.val()),css_class=e(this).attr("class"),value=value.length>0?value+" ":value,t.val(value+css_class).trigger("change"),e(".cf-layout-btn").trigger("click")})}),jQuery(function(e){var t=e(".fm");function i(i){running||(running=!0,isCopy=void 0!==i.copyfield,t.addClass("disabled"),e.ajax({type:"POST",url:$builder.attr("data-root")+"administrator/index.php?option=com_convertforms&view=form&layout=field&format=raw",data:i,success:function(n){isCopy?t.find(".fmItems .fmItem[data-key="+i.copyfield+"]").after(n):t.find(".fmItems").append(n),$response=e(n),fieldKey=$response.attr("data-key"),fieldLabel=$response.find("h3").first().children().remove().end().text(),$field=t.find(".fmAddedFields .item:last-child").clone().attr("data-key",fieldKey).find(".fmFieldLabel strong").html(fieldLabel).end().find(".fmFieldLabel small").html("(ID: "+fieldKey+")").end(),isCopy?$field.insertAfter(".fmAddedFields .item[data-key="+i.copyfield+"]"):$field.appendTo(".fmAddedFields"),t.trigger("afterAddField",[t.attr("data-nextid")]).trigger("update");var o=new CustomEvent("AfterFieldAdd",{detail:{field_key:fieldKey}});builder.dispatchEvent(o)},error:function(e,t,i){$builder.trigger("error",i)},complete:function(){running=!1,t.removeClass("disabled")}}))}function n(e){$builder.find("#sectionsTabs li a[href=#fields]").trigger("click"),o("fmItems"),t.find(".fmItem").hide().filter("[data-key="+e+"]").show(),t.trigger("afterShowField",[e])}function o(e){$tab.find('li a[href="#'+e+'"]').tab("show")}function r(e){return e=void 0===e?t.attr("data-nextid"):e,t.attr("data-formcontrol").replace("X",e)}$builder=e(".nrEditor"),builder=$builder.get(0),$tab=e("#fieldsManagerTabs"),running=!1,function(){if(el=e(".fmAddedFields"),0==el.length)return;el.sortable({update:function(i,n){$wrapper=t.find(".fmItems"),$wrapper.find(".fmItem").sort(function(t,i){return aIndex=e(".fmAddedFields .item[data-key="+e(t).attr("data-key")+"]").index(),bIndex=e(".fmAddedFields .item[data-key="+e(i).attr("data-key")+"]").index(),aIndex-bIndex}).appendTo($wrapper),t.trigger("update"),ConvertFormsBuilder.initEditorFields()}})}(),t.find(".addField").on("click",function(n){if(void 0===e(this).attr("data-pro-only")){var o=e(this).attr("data-type");i({field:{type:o,key:t.attr("data-nextid"),name:o+"_"+t.attr("data-nextid"),label:e.trim(e(this).text())},formcontrol:encodeURIComponent(r())})}}),e(document).on("click",".fmAddedFields .item",function(){n(e(this).attr("data-key")),o("fmItems")}),e(document).on("click",".removeField",function(){var i,r=e(this);if(confirm("Are you sure")){var a=r.closest("div").attr("data-key");i=a,t.find(".fmAddedFields > .item[data-key="+i+"]").remove(),t.find(".fmItem[data-key="+i+"]").remove(),t.trigger("update"),r.data("focusnext")&&((a=t.find(".fmItems > .fmItem:first-child").attr("data-key"))?n(a):o("fmaddField"))}return!1}),e(document).on("click",".copyField",function(){return function(n){var o=t.find(".fmItems > .fmItem[data-key="+n+"]");field_type=o.find("input[id$=_type]").val(),field_data=o.find("input, select, textarea"),formControl=r(n);var a={};e.map(field_data.serializeArray(),function(e,i){var n=e.name.replace(formControl,"field"),o=e.value;"field[name]"==n&&(o+="_copy"),"field[key]"==n&&(o=t.attr("data-nextid")),a[n]=o}),a.formcontrol=encodeURIComponent(r()),a.copyfield=n,i(a)}(e(this).closest("div").attr("data-key")),!1}),t.on("update",function(){$builder.trigger("renderForm")}),t.on("afterAddField",function(){key=parseInt(t.attr("data-nextid")),n(key),t.find(".hasPopover").popover({html:!0,trigger:"hover focus",container:"body"}),e(document).trigger("subform-row-add"),key+=1,t.attr("data-nextid",key)}),t.on("afterShowField",function(e,t){$builder.find(".cf-control-group").removeClass("active").filter("[data-key="+t+"]").addClass("active")}),$builder.on("controlGroupClick",function(e,t){n(t)})}),jQuery(function(e){var t=e(".st");e(".fm").on("update",function(){t.trigger("update")}),e(document).on("subform-row-add",function(){t.trigger("update")}),e(document).on("smartTagsBoxBeforeRender",function(t,i,n){var o=n.closest(".fmItem").length;if(skipFields=["jform_text","jform_footer"].indexOf(n.prev().attr("id"))>-1,skip=o||skipFields,!skip){var r={},a={Submission:{"{submission.id}":"Submission ID","{submission.date}":"Submission Date","{submission.campaign_id}":"Submission Campaign ID","{submission.form_id}":"Submission Form ID","{submission.visitor_id}":"Submission Visitor ID","{submissions.count}":"Submissions Count"}},s=e(".fmItems .fmItem");s.length&&(s.each(function(){var t=e(this),i=t.find("input[id$=__name]").val();if(!i)return!0;var n=t.find("input[id$=__label]").val();n||(n=e(".fmAddedFields .item[data-key="+t.data("key")+"]").find(".fmFieldLabel strong").text()),r[i="{field."+i+"}"]=n}),r["{all_fields}"]="All Fields",a.Fields=r,e.extend(!0,i,a))}})}),jQuery(function(e){var t=e(".nrEditor"),i="ConvertFormsState";function n(){if(state=function(){if($tabs=t.find(".nav-tabs"),0!=$tabs.children().length)return tab=$tabs.find("li.active a").attr("href").replace("#",""),panel=t.find(".tab-pane#"+tab+" .accordion-body.in.collapse"),panel.length?(panel=panel.parent().attr("class").split(" "),panel=panel[1]):panel="",tab+"-"+panel}(),void 0!=state){formID=t.find("form").attr("pk");try{Cookies.set(i+formID,state)}catch(e){console.log(e)}}}t.find(".accordion").on("shown.bs.collapse hidden.bs.collapse",function(){n()}),t.find(".nav-tabs").on("shown.bs.tab",function(){n()})});
